<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>用cloudflare搭建免费的个人短链接平台 - 六月长河</title><meta name=author content="Kingpo"><meta name=author-link content><meta name=description content><meta name=keywords content="短网址,cloudflare"><meta itemprop=name content="用cloudflare搭建免费的个人短链接平台"><meta itemprop=description content><meta itemprop=datePublished content="2022-09-21T16:00:03+08:00"><meta itemprop=dateModified content="2022-09-21T17:00:03+08:00"><meta itemprop=wordCount content="2874"><meta itemprop=image content="https://zhjin.eu.org/logo.png"><meta itemprop=keywords content="短网址,cloudflare,"><meta property="og:title" content="用cloudflare搭建免费的个人短链接平台"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://zhjin.eu.org/2022-09-21-personal-short-chain-services/"><meta property="og:image" content="https://zhjin.eu.org/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-21T16:00:03+08:00"><meta property="article:modified_time" content="2022-09-21T17:00:03+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://zhjin.eu.org/logo.png"><meta name=twitter:title content="用cloudflare搭建免费的个人短链接平台"><meta name=twitter:description content><meta name=application-name content="六月长河"><meta name=apple-mobile-web-app-title content="六月长河"><meta name=theme-color data-light=#ffffff data-dark=#252627 content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://zhjin.eu.org/2022-09-21-personal-short-chain-services/><link rel=prev href=https://zhjin.eu.org/2022-09-16-submit-to-search-engine/><link rel=next href=https://zhjin.eu.org/2022-09-28-github-pages-custom-domain-name/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"用cloudflare搭建免费的个人短链接平台","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/zhjin.eu.org\/2022-09-21-personal-short-chain-services\/"},"image":["https:\/\/zhjin.eu.org\/site-meta.jpg"],"genre":"posts","keywords":"短网址, cloudflare","wordcount":2874,"url":"https:\/\/zhjin.eu.org\/2022-09-21-personal-short-chain-services\/","datePublished":"2022-09-21T16:00:03+08:00","dateModified":"2022-09-21T17:00:03+08:00","publisher":{"@type":"Organization","name":"Kingpo","logo":"https:\/\/zhjin.eu.org\/images\/avatar.png"},"author":{"@type":"Person","name":"Kingpo"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title=六月长河><span class=header-title-text>六月长河</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class="menu-item text-center"><a class=menu-link href=/posts/ title=所有文章><i class='fas fa-archive fa-fw fa-sm'></i> 文章</a></li><li class="menu-item text-center"><a class=menu-link href=/categories/><i class='fas fa-th fa-fw fa-sm'></i> 分类</a></li><li class="menu-item text-center"><a class=menu-link href=/tags/><i class='fas fa-tags fa-fw fa-sm'></i> 标签</a></li><li class="menu-item text-center"><a class=menu-link href=/friends/><i class='fas fa-users fa-fw fa-sm'></i> 友链</a></li><li class="menu-item text-center"><a class=menu-link href=/guestbook/><i class='fas fa-comments fa-fw fa-sm'></i> 留言</a></li><li class="menu-item text-center"><a class=menu-link href=/about/><i class='fas fa-user-tie fa-fw fa-sm'></i> 关于</a></li><li class="menu-item text-center"><a class=menu-link href=/tool/><i class='fas fa-cube fa-fw fa-sm'></i> 工具箱</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=六月长河><span class=header-title-text>六月长河</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class="menu-item text-center"><a class=menu-link href=/posts/ title=所有文章><i class='fas fa-archive fa-fw fa-sm'></i> 文章</a></li><li class="menu-item text-center"><a class=menu-link href=/categories/><i class='fas fa-th fa-fw fa-sm'></i> 分类</a></li><li class="menu-item text-center"><a class=menu-link href=/tags/><i class='fas fa-tags fa-fw fa-sm'></i> 标签</a></li><li class="menu-item text-center"><a class=menu-link href=/friends/><i class='fas fa-users fa-fw fa-sm'></i> 友链</a></li><li class="menu-item text-center"><a class=menu-link href=/guestbook/><i class='fas fa-comments fa-fw fa-sm'></i> 留言</a></li><li class="menu-item text-center"><a class=menu-link href=/about/><i class='fas fa-user-tie fa-fw fa-sm'></i> 关于</a></li><li class="menu-item text-center"><a class=menu-link href=/tool/><i class='fas fa-cube fa-fw fa-sm'></i> 工具箱</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container data-page-style=narrow><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>用cloudflare搭建免费的个人短链接平台</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><img class="lazyload avatar" src=/svg/loading.min.svg data-src=/images/avatar.png data-srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" data-sizes=auto alt=Kingpo title=Kingpo>&nbsp;Kingpo</span></span>
<span class=post-category>收录于 <a href=/categories/%E7%9F%AD%E7%BD%91%E5%9D%80/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 短网址</a></span></div><div class=post-meta-line><span title="2022-09-21 16:00:03"><i class="fa-regular fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-09-21>2022-09-21</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i> 约 2874 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw" aria-hidden=true></i> 预计阅读 6 分钟</span>&nbsp;<span id=/2022-09-21-personal-short-chain-services/ class="leancloud_visitors comment-visitors" data-flag-title=用cloudflare搭建免费的个人短链接平台>
<i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span class=leancloud-visitors-count>-</span>&nbsp;次阅读
</span>&nbsp;<span class=comment-count data-flag-title=用cloudflare搭建免费的个人短链接平台>
<i class="fa-regular fa-comments fa-fw" aria-hidden=true></i>&nbsp;<span data-xid=/2022-09-21-personal-short-chain-services/ class=valine-comment-count>-</span>&nbsp;条评论
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#短链接>短链接</a></li><li><a href=#自建短链接平台>自建短链接平台</a></li><li><a href=#参考>参考</a></li></ul></nav></div></div><div class=content id=content><h2 id=短链接>短链接</h2><p>短链接又称短网址、短码，意思就是形式上比较短的网址。短链接服务，可以通过将一个普通的冗长的网址缩短生成一个新的较短的网址，便于分享传播。</p><p>短链接主要应用场景如下：</p><ul><li>短信发送</li></ul><blockquote><p>短信里用短链接，可以极大减少字符，现在很多营销短信都是用的短网址。</p></blockquote><ul><li>社群推广</li></ul><blockquote><p>很多社区或社交网站，会屏蔽长链接。微博字数限制，公众号关键字链接限制等，短网址可以缩短字符，规避掉这些限制。</p></blockquote><ul><li>微信防屏蔽</li></ul><blockquote><p>微信里有各种屏蔽，用短链接可以避免暴露原有地址关键字，规避屏蔽。</p></blockquote><ul><li>活码</li></ul><blockquote><p>短网址是固定的，可以通过修改原链接达到变更地址的作用，此时不用去修改固定的短网址，短网址就相当于一个中间层。主要用于替换更换链接成本较高的地方，比如生成好的二维码等。</p></blockquote><p><strong>PS：短链接服务一定要用大厂，一般不至于跑路，稳定性有所保证。</strong></p><h2 id=自建短链接平台>自建短链接平台</h2><p>这里利用cloudflare workers提供的服务，免费版本每日100000次请求，对个人使用而言完全足够。</p><p>脚本配置基于GitHub开源项目<a href=https://github.com/AoEiuV020/Url-Shorten-Worker target=_blank rel="external nofollow noopener noreferrer">AoEiuV020/Url-Shorten-Worker</a></p><p><strong>你需要什么：</strong></p><ul><li>已注册cloudflare账号</li><li>自己的域名，越短越好，由cloudflare作解析。</li></ul><p><strong>操作流程：</strong></p><ol><li>Workers KV中创建一个命名空间，名称随意，比如link。</li></ol><p><img class=lazyload src=/svg/loading.min.svg data-src=https://s3.bmp.ovh/imgs/2022/09/21/4501767843e6885d.png data-srcset="https://s3.bmp.ovh/imgs/2022/09/21/4501767843e6885d.png, https://s3.bmp.ovh/imgs/2022/09/21/4501767843e6885d.png 1.5x, https://s3.bmp.ovh/imgs/2022/09/21/4501767843e6885d.png 2x" data-sizes=auto alt=https://s3.bmp.ovh/imgs/2022/09/21/4501767843e6885d.png title=https://s3.bmp.ovh/imgs/2022/09/21/4501767843e6885d.png></p><ol start=2><li>Workers创建新服务，服务名称随意，启动器选择http路由器。
<img class=lazyload src=/svg/loading.min.svg data-src=https://s3.bmp.ovh/imgs/2022/09/21/2a995b96fdb66cc8.png data-srcset="https://s3.bmp.ovh/imgs/2022/09/21/2a995b96fdb66cc8.png, https://s3.bmp.ovh/imgs/2022/09/21/2a995b96fdb66cc8.png 1.5x, https://s3.bmp.ovh/imgs/2022/09/21/2a995b96fdb66cc8.png 2x" data-sizes=auto alt=https://s3.bmp.ovh/imgs/2022/09/21/2a995b96fdb66cc8.png title=https://s3.bmp.ovh/imgs/2022/09/21/2a995b96fdb66cc8.png>
<img class=lazyload src=/svg/loading.min.svg data-src=https://s3.bmp.ovh/imgs/2022/09/21/7e2497de3e59f2bb.png data-srcset="https://s3.bmp.ovh/imgs/2022/09/21/7e2497de3e59f2bb.png, https://s3.bmp.ovh/imgs/2022/09/21/7e2497de3e59f2bb.png 1.5x, https://s3.bmp.ovh/imgs/2022/09/21/7e2497de3e59f2bb.png 2x" data-sizes=auto alt=https://s3.bmp.ovh/imgs/2022/09/21/7e2497de3e59f2bb.png title=https://s3.bmp.ovh/imgs/2022/09/21/7e2497de3e59f2bb.png></li><li>进入Workers服务，设置=》变量=》KV命名空间绑定，变量名称大写<code>LINKS</code>，值就是那个命名空间名；环境变量里再添加系列变量。变量说明如下：</li></ol><blockquote><p><strong>调整超时设置</strong><br>演示模式生成的短链接超时无法访问，<br>白名单或者密码正确情况超时设置无效，<br>修改脚本开头的变量shorten_timeout, 单位毫秒，0表示不设置超时</p></blockquote><blockquote><p><strong>调整白名单</strong>
白名单中的域名设置短链接无视超时，<br>修改脚本开头的变量white_list, 是个json数组，写顶级域名就可以，自动通过顶级域名和所有二级域名</p></blockquote><blockquote><p><strong>关闭演示模式</strong>
只有演示模式开启才允许访客无密码添加非白名单地址，超时短链接会失效，<br>修改脚本开头的变量demo_mode，为true开启演示，为false无密码且非白名单请求不受理</p></blockquote><blockquote><p><strong>自动删除演示记录</strong>
针对演示模式开启情况下的超时失效的短链接记录是否自动删除，<br>修改脚本开头的变量remove_completely，为true自动删除超时的演示短链接记录，否则仅是标记过期，以便在后台查询历史记录</p></blockquote><blockquote><p><strong>修改密码</strong>
网页有个隐藏输入框可以输入密码，<br>密码正确情况无视白名单和超时设置，且支持自定义短链接，<br>修改脚本开头的变量password，这个私密信息比较建议直接在环境变量里配置</p></blockquote><blockquote><p><strong>修改短链长度</strong>
短链长度就是随机生成的key也就是短链接的path部分的长度，<br>长度不够时容易出现重复，遇到重复时会自动延长，<br>修改脚本开头的变量default_len</p></blockquote><p><strong>注意：key均为对应大写</strong></p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://s3.bmp.ovh/imgs/2022/09/21/91f857cd7be7e6d1.png data-srcset="https://s3.bmp.ovh/imgs/2022/09/21/91f857cd7be7e6d1.png, https://s3.bmp.ovh/imgs/2022/09/21/91f857cd7be7e6d1.png 1.5x, https://s3.bmp.ovh/imgs/2022/09/21/91f857cd7be7e6d1.png 2x" data-sizes=auto alt=https://s3.bmp.ovh/imgs/2022/09/21/91f857cd7be7e6d1.png title=https://s3.bmp.ovh/imgs/2022/09/21/91f857cd7be7e6d1.png></p><ol start=4><li>回到【资源】，快速编辑，复制项目中的<code>index.js</code>的代码，即以下代码内容，保存并编译。
<img class=lazyload src=/svg/loading.min.svg data-src=https://s3.bmp.ovh/imgs/2022/09/21/1a7aea4ce4f40ac9.png data-srcset="https://s3.bmp.ovh/imgs/2022/09/21/1a7aea4ce4f40ac9.png, https://s3.bmp.ovh/imgs/2022/09/21/1a7aea4ce4f40ac9.png 1.5x, https://s3.bmp.ovh/imgs/2022/09/21/1a7aea4ce4f40ac9.png 2x" data-sizes=auto alt=https://s3.bmp.ovh/imgs/2022/09/21/1a7aea4ce4f40ac9.png title=https://s3.bmp.ovh/imgs/2022/09/21/1a7aea4ce4f40ac9.png></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span><span class=lnt>368
</span><span class=lnt>369
</span><span class=lnt>370
</span><span class=lnt>371
</span><span class=lnt>372
</span><span class=lnt>373
</span><span class=lnt>374
</span><span class=lnt>375
</span><span class=lnt>376
</span><span class=lnt>377
</span><span class=lnt>378
</span><span class=lnt>379
</span><span class=lnt>380
</span><span class=lnt>381
</span><span class=lnt>382
</span><span class=lnt>383
</span><span class=lnt>384
</span><span class=lnt>385
</span><span class=lnt>386
</span><span class=lnt>387
</span><span class=lnt>388
</span><span class=lnt>389
</span><span class=lnt>390
</span><span class=lnt>391
</span><span class=lnt>392
</span><span class=lnt>393
</span><span class=lnt>394
</span><span class=lnt>395
</span><span class=lnt>396
</span><span class=lnt>397
</span><span class=lnt>398
</span><span class=lnt>399
</span><span class=lnt>400
</span><span class=lnt>401
</span><span class=lnt>402
</span><span class=lnt>403
</span><span class=lnt>404
</span><span class=lnt>405
</span><span class=lnt>406
</span><span class=lnt>407
</span><span class=lnt>408
</span><span class=lnt>409
</span><span class=lnt>410
</span><span class=lnt>411
</span><span class=lnt>412
</span><span class=lnt>413
</span><span class=lnt>414
</span><span class=lnt>415
</span><span class=lnt>416
</span><span class=lnt>417
</span><span class=lnt>418
</span><span class=lnt>419
</span><span class=lnt>420
</span><span class=lnt>421
</span><span class=lnt>422
</span><span class=lnt>423
</span><span class=lnt>424
</span><span class=lnt>425
</span><span class=lnt>426
</span><span class=lnt>427
</span><span class=lnt>428
</span><span class=lnt>429
</span><span class=lnt>430
</span><span class=lnt>431
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>//index.js源代码
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 项目名，决定html从哪个项目获取，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>github_repo</span> <span class=o>=</span> <span class=k>typeof</span><span class=p>(</span><span class=nx>GITHUB_REPO</span><span class=p>)</span><span class=o>!=</span><span class=s2>&#34;undefined&#34;</span> <span class=o>?</span> <span class=nx>GITHUB_REPO</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=s1>&#39;charlie-king/Url-Shorten-Worker&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 项目版本，cdn会有缓存，所以有更新时需要指定版本，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>github_version</span> <span class=o>=</span> <span class=k>typeof</span><span class=p>(</span><span class=nx>GITHUB_VERSION</span><span class=p>)</span><span class=o>!=</span><span class=s2>&#34;undefined&#34;</span> <span class=o>?</span> <span class=nx>GITHUB_VERSION</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=s1>&#39;@main&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 密码，密码正确情况无视白名单和超时设置，且支持自定义短链接，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>password</span> <span class=o>=</span> <span class=k>typeof</span><span class=p>(</span><span class=nx>PASSWORD</span><span class=p>)</span><span class=o>!=</span><span class=s2>&#34;undefined&#34;</span> <span class=o>?</span> <span class=nx>PASSWORD</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=s1>&#39;AoEiuV020 yes&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 短链超时，单位毫秒，支持整数乘法，0表示不设置超时，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>shorten_timeout</span> <span class=o>=</span> <span class=k>typeof</span><span class=p>(</span><span class=nx>SHORTEN_TIMEOUT</span><span class=p>)</span><span class=o>!=</span><span class=s2>&#34;undefined&#34;</span> <span class=o>?</span> <span class=nx>SHORTEN_TIMEOUT</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;*&#34;</span><span class=p>).</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>a</span><span class=p>,</span><span class=nx>b</span><span class=p>)=&gt;</span><span class=nb>parseInt</span><span class=p>(</span><span class=nx>a</span><span class=p>)</span><span class=o>*</span><span class=nb>parseInt</span><span class=p>(</span><span class=nx>b</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=p>(</span><span class=mi>1000</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 默认短链key的长度，遇到重复时会自动延长，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>default_len</span> <span class=o>=</span> <span class=k>typeof</span><span class=p>(</span><span class=nx>DEFAULT_LEN</span><span class=p>)</span><span class=o>!=</span><span class=s2>&#34;undefined&#34;</span> <span class=o>?</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>DEFAULT_LEN</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 为true开启演示，否则无密码且非白名单请求不受理，是则允许访客试用，超时后失效，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>demo_mode</span> <span class=o>=</span> <span class=k>typeof</span><span class=p>(</span><span class=nx>DEMO_MODE</span><span class=p>)</span><span class=o>!=</span><span class=s2>&#34;undefined&#34;</span> <span class=o>?</span> <span class=nx>DEMO_MODE</span> <span class=o>===</span> <span class=s1>&#39;true&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 为true自动删除超时的演示短链接记录，否则仅是标记过期，以便在后台查询历史记录，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>remove_completely</span> <span class=o>=</span> <span class=k>typeof</span><span class=p>(</span><span class=nx>REMOVE_COMPLETELY</span><span class=p>)</span><span class=o>!=</span><span class=s2>&#34;undefined&#34;</span> <span class=o>?</span> <span class=nx>REMOVE_COMPLETELY</span> <span class=o>===</span> <span class=s1>&#39;true&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 白名单中的域名无视超时，json数组格式，写顶级域名就可以，自动通过顶级域名和所有二级域名，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>white_list</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=nx>WHITE_LIST</span><span class=p>)</span><span class=o>!=</span><span class=s2>&#34;undefined&#34;</span> <span class=o>?</span> <span class=nx>WHITE_LIST</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=sb>`[
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>&#34;aoeiuv020.com&#34;,
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>&#34;aoeiuv020.cn&#34;,
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>&#34;aoeiuv020.cc&#34;,
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>&#34;020.name&#34;
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>    ]`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 演示模式开启时网页上展示这段禁止滥用提示，并不需要明确表示什么时候失效，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>demo_notice</span> <span class=o>=</span> <span class=k>typeof</span><span class=p>(</span><span class=nx>DEMO_NOTICE</span><span class=p>)</span><span class=o>!=</span><span class=s2>&#34;undefined&#34;</span> <span class=o>?</span> <span class=nx>DEMO_NOTICE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=sb>`注意：为防止示例服务被人滥用，故所有由demo网站生成的链接随时可能失效，如需长期使用请自行搭建。`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//console.log(`${github_repo}, ${github_version}, ${password}, ${shorten_timeout}, ${demo_mode}, ${white_list}, ${demo_notice}`)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>html404</span> <span class=o>=</span> <span class=sb>`&lt;!DOCTYPE html&gt;
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>&lt;body&gt;
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>  &lt;h1&gt;404 Not Found.&lt;/h1&gt;
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>  &lt;p&gt;The url you visit is not found.&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>&lt;/body&gt;`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>randomString</span><span class=p>(</span><span class=nx>len</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  　　<span class=kd>let</span> <span class=nx>$chars</span> <span class=o>=</span> <span class=s1>&#39;ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678&#39;</span><span class=p>;</span>    <span class=cm>/****默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1****/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  　　<span class=kd>let</span> <span class=nx>maxPos</span> <span class=o>=</span> <span class=nx>$chars</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>　　<span class=kd>let</span> <span class=nx>result</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>　　<span class=k>for</span> <span class=p>(</span><span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>len</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>　　　　<span class=nx>result</span> <span class=o>+=</span> <span class=nx>$chars</span><span class=p>.</span><span class=nx>charAt</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=nx>maxPos</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>　　<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>　　<span class=k>return</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>checkURL</span><span class=p>(</span><span class=nx>url</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>str</span><span class=o>=</span><span class=nx>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>Expression</span><span class=o>=</span><span class=sr>/^http(s)?:\/\/(.*@)?([\w-]+\.)*[\w-]+([_\-.,~!*:#()\w\/?%&amp;=]*)?$/</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>objExp</span><span class=o>=</span><span class=k>new</span> <span class=nb>RegExp</span><span class=p>(</span><span class=nx>Expression</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>objExp</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>str</span><span class=p>)</span><span class=o>==</span><span class=kc>true</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>str</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;h&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>else</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 检查域名是否在白名单中，参数只包含域名部分，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>checkWhite</span><span class=p>(</span><span class=nx>host</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>white_list</span><span class=p>.</span><span class=nx>some</span><span class=p>((</span><span class=nx>h</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>host</span> <span class=o>==</span> <span class=nx>h</span> <span class=o>||</span> <span class=nx>host</span><span class=p>.</span><span class=nx>endsWith</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=o>+</span><span class=nx>h</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>md5</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>msgUint8</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>TextEncoder</span><span class=p>().</span><span class=nx>encode</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=c1>// encode as (utf-8) Uint8Array
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>hashBuffer</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>crypto</span><span class=p>.</span><span class=nx>subtle</span><span class=p>.</span><span class=nx>digest</span><span class=p>(</span><span class=s1>&#39;MD5&#39;</span><span class=p>,</span> <span class=nx>msgUint8</span><span class=p>)</span> <span class=c1>// hash the message
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>hashArray</span> <span class=o>=</span> <span class=nb>Array</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=k>new</span> <span class=nx>Uint8Array</span><span class=p>(</span><span class=nx>hashBuffer</span><span class=p>))</span> <span class=c1>// convert buffer to byte array
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>hashHex</span> <span class=o>=</span> <span class=nx>hashArray</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>b</span> <span class=p>=&gt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=mi>16</span><span class=p>).</span><span class=nx>padStart</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=s1>&#39;0&#39;</span><span class=p>)).</span><span class=nx>join</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span> <span class=c1>// convert bytes to hex string
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>hashHex</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>checkHash</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=nx>hash</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>hash</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=kr>await</span> <span class=nx>md5</span><span class=p>(</span><span class=nx>url</span><span class=o>+</span><span class=nx>password</span><span class=p>))</span> <span class=o>==</span> <span class=nx>hash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>save_url</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>admin</span><span class=p>,</span> <span class=nx>len</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>　　<span class=nx>len</span> <span class=o>=</span> <span class=nx>len</span> <span class=o>||</span> <span class=nx>default_len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 密码正确且指定了key的情况直接覆盖旧值，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>override</span> <span class=o>=</span> <span class=nx>admin</span> <span class=o>&amp;&amp;</span> <span class=nx>key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>override</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 密码不正确情况无视指定key,
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=nx>key</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>randomString</span><span class=p>(</span><span class=nx>len</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>is_exists</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>load_url</span><span class=p>(</span><span class=nx>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;key exists &#34;</span> <span class=o>+</span> <span class=nx>key</span> <span class=o>+</span> <span class=s2>&#34; &#34;</span> <span class=o>+</span> <span class=nx>is_exists</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>override</span> <span class=o>||</span> <span class=o>!</span><span class=nx>is_exists</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>mode</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>admin</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nx>mode</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>value</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>mode</span><span class=si>}</span><span class=sb>;</span><span class=si>${</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=si>}</span><span class=sb>;</span><span class=si>${</span><span class=nx>url</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>remove_completely</span> <span class=o>&amp;&amp;</span> <span class=nx>mode</span> <span class=o>!=</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=kr>await</span> <span class=nx>checkWhite</span><span class=p>(</span><span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=nx>url</span><span class=p>).</span><span class=nx>host</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=c1>// 利用expirationTtl实现过期记录自动删除，低于60秒会报错，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>          <span class=kd>let</span> <span class=nx>ttl</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(</span><span class=mi>60</span><span class=p>,</span> <span class=nx>shorten_timeout</span> <span class=o>/</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;key auto remove: &#34;</span> <span class=o>+</span> <span class=nx>key</span> <span class=o>+</span> <span class=s2>&#34;, &#34;</span> <span class=o>+</span> <span class=nx>ttl</span> <span class=o>+</span> <span class=s2>&#34;s&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=kr>await</span> <span class=nx>LINKS</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=nx>value</span><span class=p>,</span> <span class=p>{</span><span class=nx>expirationTtl</span><span class=o>:</span> <span class=nx>ttl</span><span class=p>}),</span><span class=nx>key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=kr>await</span> <span class=nx>LINKS</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=nx>value</span><span class=p>),</span><span class=nx>key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kr>await</span> <span class=nx>save_url</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>admin</span><span class=p>,</span> <span class=nx>len</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>load_url</span><span class=p>(</span><span class=nx>key</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>value</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>LINKS</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>list</span> <span class=o>=</span> <span class=nx>value</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;value split &#34;</span> <span class=o>+</span> <span class=nx>list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>url</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>list</span><span class=p>.</span><span class=nx>length</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 老数据暂且正常跳转，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=nx>url</span> <span class=o>=</span> <span class=nx>list</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>url</span> <span class=o>=</span> <span class=nx>list</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>mode</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>list</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>create_time</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>list</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>mode</span> <span class=o>!=</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>shorten_timeout</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=o>&amp;&amp;</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>create_time</span> <span class=o>&gt;</span> <span class=nx>shorten_timeout</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>host</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=nx>url</span><span class=p>).</span><span class=nx>host</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=kr>await</span> <span class=nx>checkWhite</span><span class=p>(</span><span class=nx>host</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;white list&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>// 超时和找不到做同样的处理，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;shorten timeout&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>url</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>handleRequest</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>method</span> <span class=o>===</span> <span class=s2>&#34;POST&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>req</span><span class=o>=</span><span class=kr>await</span> <span class=nx>request</span><span class=p>.</span><span class=nx>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;url &#34;</span> <span class=o>+</span> <span class=nx>req</span><span class=p>[</span><span class=s2>&#34;url&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>admin</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>checkHash</span><span class=p>(</span><span class=nx>req</span><span class=p>[</span><span class=s2>&#34;url&#34;</span><span class=p>],</span> <span class=nx>req</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;admin &#34;</span> <span class=o>+</span> <span class=nx>admin</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=kr>await</span> <span class=nx>checkURL</span><span class=p>(</span><span class=nx>req</span><span class=p>[</span><span class=s2>&#34;url&#34;</span><span class=p>])</span> <span class=o>||</span> <span class=p>(</span><span class=o>!</span><span class=nx>admin</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>demo_mode</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=kr>await</span> <span class=nx>checkWhite</span><span class=p>(</span><span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=nx>req</span><span class=p>[</span><span class=s2>&#34;url&#34;</span><span class=p>]).</span><span class=nx>host</span><span class=p>))){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 非演示模式下，非白名单地址当成地址不合法处理，
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=sb>`{&#34;status&#34;:500,&#34;key&#34;:&#34;: Error: Url illegal.&#34;}`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;content-type&#34;</span><span class=o>:</span> <span class=s2>&#34;text/html;charset=UTF-8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Access-Control-Allow-Origin&#34;</span><span class=o>:</span><span class=s2>&#34;*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Access-Control-Allow-Methods&#34;</span><span class=o>:</span> <span class=s2>&#34;POST&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>})}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>stat</span><span class=p>,</span><span class=nx>random_key</span><span class=o>=</span><span class=kr>await</span> <span class=nx>save_url</span><span class=p>(</span><span class=nx>req</span><span class=p>[</span><span class=s2>&#34;url&#34;</span><span class=p>],</span> <span class=nx>req</span><span class=p>[</span><span class=s2>&#34;key&#34;</span><span class=p>],</span> <span class=nx>admin</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;stat &#34;</span> <span class=o>+</span> <span class=nx>stat</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=nx>stat</span><span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;undefined&#34;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=sb>`{&#34;status&#34;:200,&#34;key&#34;:&#34;/`</span><span class=o>+</span><span class=nx>random_key</span><span class=o>+</span><span class=sb>`&#34;}`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;content-type&#34;</span><span class=o>:</span> <span class=s2>&#34;text/html;charset=UTF-8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Access-Control-Allow-Origin&#34;</span><span class=o>:</span><span class=s2>&#34;*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Access-Control-Allow-Methods&#34;</span><span class=o>:</span> <span class=s2>&#34;POST&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=sb>`{&#34;status&#34;:200,&#34;key&#34;:&#34;: Error:Reach the KV write limitation.&#34;}`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;content-type&#34;</span><span class=o>:</span> <span class=s2>&#34;text/html;charset=UTF-8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Access-Control-Allow-Origin&#34;</span><span class=o>:</span><span class=s2>&#34;*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Access-Control-Allow-Methods&#34;</span><span class=o>:</span> <span class=s2>&#34;POST&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>})}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>method</span> <span class=o>===</span> <span class=s2>&#34;OPTIONS&#34;</span><span class=p>){</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=sb>``</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;content-type&#34;</span><span class=o>:</span> <span class=s2>&#34;text/html;charset=UTF-8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Access-Control-Allow-Origin&#34;</span><span class=o>:</span><span class=s2>&#34;*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Access-Control-Allow-Methods&#34;</span><span class=o>:</span> <span class=s2>&#34;POST&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>requestURL</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>requestURL</span><span class=p>.</span><span class=nx>pathname</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>path</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>html</span><span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`https://cdn.jsdelivr.net/gh/</span><span class=si>${</span><span class=nx>github_repo</span><span class=si>}${</span><span class=nx>github_version</span><span class=si>}</span><span class=sb>/index.html`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>text</span> <span class=o>=</span> <span class=p>(</span><span class=kr>await</span> <span class=nx>html</span><span class=p>.</span><span class=nx>text</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>replaceAll</span><span class=p>(</span><span class=s2>&#34;###GITHUB_REPO###&#34;</span><span class=p>,</span> <span class=nx>github_repo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>replaceAll</span><span class=p>(</span><span class=s2>&#34;###GITHUB_VERSION###&#34;</span><span class=p>,</span> <span class=nx>github_version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>replaceAll</span><span class=p>(</span><span class=s2>&#34;###DEMO_NOTICE###&#34;</span><span class=p>,</span> <span class=nx>demo_notice</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=nx>text</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;content-type&#34;</span><span class=o>:</span> <span class=s2>&#34;text/html;charset=UTF-8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>load_url</span><span class=p>(</span><span class=nx>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 找不到或者超时直接404,
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;not found&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=nx>html404</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;content-type&#34;</span><span class=o>:</span> <span class=s2>&#34;text/html;charset=UTF-8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=mi>404</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>Response</span><span class=p>.</span><span class=nx>redirect</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=mi>302</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;fetch&#34;</span><span class=p>,</span> <span class=kr>async</span> <span class=nx>event</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>event</span><span class=p>.</span><span class=nx>respondWith</span><span class=p>(</span><span class=nx>handleRequest</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>request</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><ol start=5><li>最后一步，添加自定义域名，域名需先托管到cloudflare解析，此时你就可以通过这个域名访问并生成短链接了。
<img class=lazyload src=/svg/loading.min.svg data-src=https://s3.bmp.ovh/imgs/2022/09/21/c37a4a51bfd43137.png data-srcset="https://s3.bmp.ovh/imgs/2022/09/21/c37a4a51bfd43137.png, https://s3.bmp.ovh/imgs/2022/09/21/c37a4a51bfd43137.png 1.5x, https://s3.bmp.ovh/imgs/2022/09/21/c37a4a51bfd43137.png 2x" data-sizes=auto alt=https://s3.bmp.ovh/imgs/2022/09/21/c37a4a51bfd43137.png title=https://s3.bmp.ovh/imgs/2022/09/21/c37a4a51bfd43137.png>
<img class=lazyload src=/svg/loading.min.svg data-src=https://s3.bmp.ovh/imgs/2022/09/21/ec642a71175ef4b2.png data-srcset="https://s3.bmp.ovh/imgs/2022/09/21/ec642a71175ef4b2.png, https://s3.bmp.ovh/imgs/2022/09/21/ec642a71175ef4b2.png 1.5x, https://s3.bmp.ovh/imgs/2022/09/21/ec642a71175ef4b2.png 2x" data-sizes=auto alt=https://s3.bmp.ovh/imgs/2022/09/21/ec642a71175ef4b2.png title=https://s3.bmp.ovh/imgs/2022/09/21/ec642a71175ef4b2.png></li></ol><h2 id=参考>参考</h2><blockquote><p><a href=https://github.com/AoEiuV020/Url-Shorten-Worker target=_blank rel="external nofollow noopener noreferrer">https://github.com/AoEiuV020/Url-Shorten-Worker</a></p></blockquote><div class=post-promote><input type=checkbox name=promote id=promote hidden>
<label class=promote-button for=promote>关注一下有惊喜</label><div class=qr-code><label class=qr-code-image for=promote><img class=image src=/images/wxqr.png>
<span>公众号</span></label></div></div><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=/images/wechatpay.png>
<span>微信打赏</span></label>
<label class=qr-code-image for=reward><img class=image src=/images/alipay.png>
<span>支付宝打赏</span></label></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2022-09-21 17:00:03">更新于 2022-09-21&nbsp;<a class=git-hash href=https://github.com/Charlie-king/hugo-blog/commit/9f6d16f4025418080336aa5d721c33a6c2c3f74e rel="external nofollow noopener noreferrer" target=_blank title="commit by jinbo(zhjin66@qq.com) 9f6d16f4025418080336aa5d721c33a6c2c3f74e: :pencil: 调整文章文件名称格式"><i class="fa-solid fa-hashtag fa-fw" aria-hidden=true></i>9f6d16f</a></span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/2022-09-21-personal-short-chain-services/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span><span><a href=https://github.com/Charlie-king/hugo-blog/edit/main/content/posts/2022-09-21%20-%20Personal%20short-chain%20services.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://zhjin.eu.org/2022-09-21-personal-short-chain-services/ data-title=用cloudflare搭建免费的个人短链接平台 data-ralateuid=2296265347><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 百度" data-sharer=baidu data-url=https://zhjin.eu.org/2022-09-21-personal-short-chain-services/ data-title=用cloudflare搭建免费的个人短链接平台><i data-svg-src=/lib/simple-icons/icons/baidu.min.svg aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://zhjin.eu.org/2022-09-21-personal-short-chain-services/ data-title=用cloudflare搭建免费的个人短链接平台><i class="fa-brands fa-evernote fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/%E7%9F%AD%E7%BD%91%E5%9D%80/>短网址</a>,&nbsp;<a href=/tags/cloudflare/>cloudflare</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2022-09-16-submit-to-search-engine/ class=prev rel=prev title=个人博客或网站提交搜索引擎收录><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>个人博客或网站提交搜索引擎收录</a>
<a href=/2022-09-28-github-pages-custom-domain-name/ class=next rel=next title="GitHub pages配置自定义域名利用Cloudflare全球CDN">GitHub pages配置自定义域名利用Cloudflare全球CDN<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/ rel="external nofollow noopener noreferrer">Valine</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom"><a href="https://statcounter.com/p12800592/?guest=1" target=_blank>全平台总访问统计</a>
<script type=text/javascript>var sc_project=12800592,sc_invisible=0,sc_security="6f21fa5b",scJsHost="https://";document.write("<script type='text/javascript' src='"+scJsHost+"statcounter.com/counter/counter.js'><\/script>")</script><noscript><div class=statcounter><a title="web stats" href=https://statcounter.com/ target=_blank><img referrerpolicy=no-referrer-when-downgrade></a></div></noscript></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>
<a href=/>Kingpo</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class=site-time title='网站运行中 ...'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i>&nbsp;<span class=run-times>网站运行中 ...</span></span></div><div class="footer-line ibruce"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/Charlie-king/charlie-king.github.io title="在 GitHub 上查看" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--progress-h:3px;--bg-progress-dark:top></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script src=/lib/valine/Valine.min.js></script><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script src=/lib/lazysizes/lazysizes.min.js async defer></script><script src=/lib/twemoji/twemoji.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:20},comment:{enable:!0,valine:{appId:"fBVoqMFU1xet9Og99sfzU2Pu-MdYXbMMI",appKey:"tdTYEKQLqjlE8Mh6tmCs2Vtz",avatar:"monsterid",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!0,highlight:!0,lang:"zh-CN",meta:["nick","mail","link"],pageSize:10,placeholder:"欢迎交流！已开启邮箱留言通知。留邮箱可第一时间收到回复通知。",recordIP:!0,serverURLs:"https://le.kinpo.eu.org",visitor:!0}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,enablePangu:!0,lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"B6R922P6DD",algoliaIndex:"dev_hugo",algoliaSearchKey:"65d9478dcc1a7a885ab0286fc7721433",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},siteTime:"2022-07-13T19:30:34+08:00",twemoji:!0}</script><script src=/js/theme.min.js defer></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?7cb809210cfc0651ecb64a362e53bf99",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script>
<script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?2111c670794ab20de2746cf028182bbb",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?3e2c1ee7bae67fc556147b956290102f",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?62f2a79138a93ccdae1fd51bc7f41dc4",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></body></html>